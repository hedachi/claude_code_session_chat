# aiai - エージェント間メッセージング

## chat.js - エージェント間通信

`chat.js` はファイルベースの非同期メッセージングツール。Claude Codeエージェント同士がバックグラウンド実行を使って会話できる。

### コマンド

```bash
node chat.js --name              # ランダムな名前を1つ取得（100種類）
node chat.js --clear             # チャットファイルをクリア
node chat.js                     # 全メッセージを読んで出力（即終了）
node chat.js "名前: メッセージ"   # メッセージを書き込み、次の返信が来るまで待機→受信したら出力して終了
```

### チャットファイル

`/tmp/claude-chat.txt` に1行1メッセージで記録される。

### しりとりの実行手順

ユーザーに「しりとり実行して」と言われたら、以下の手順で他のエージェントとしりとりをする。

**重要: 2体のエージェントを自分で起動するのではない。あなた自身が1体のエージェントとして参加する。**

#### 手順

1. `node chat.js --name` で自分の名前を決める（例: パセリ）
2. `node chat.js` で既存メッセージを確認する
3. 既存メッセージがなければ、あなたが先攻。最初のしりとりワードを送る:
   ```
   node chat.js "パセリ: しりとりしよう！りんご"
   ```
   これを `run_in_background: true` で実行する。相手の返信が来るまで待機状態になる。
4. 既存メッセージがあれば、あなたは後攻。最後のメッセージの末尾の文字でしりとりを続ける:
   ```
   node chat.js "パセリ: ごりら"
   ```
   これも `run_in_background: true` で実行する。
5. バックグラウンドタスクの完了通知が届いたら、出力ファイルを読んで相手の返信を確認する
6. 相手の返信の末尾の文字で次のワードを考え、4に戻る
7. 「ん」で終わる単語を言ったら負け。相手が「ん」で終わったら勝ちを宣言する

#### しりとりのルール
- 末尾の文字で始まる単語を返す（「ご」で終わったら「ご」で始まる単語）
- 末尾が長音「ー」の場合、その前の文字を使う（「コンピューター」→「た」）
- 「ん」で終わる単語を言ったら負け
- 同じ単語の繰り返し禁止

### 注意

- 名前は起動時に1回決めて、セッション中は同じ名前を使い続けること
- メッセージ形式は `名前: 本文` で統一
- `node chat.js "メッセージ"` は書き込み後、次のメッセージが来るまでプロセスが終了しない。必ず `run_in_background: true` で実行すること
- 通常のタスクと並行してメッセージを待てるのがこの仕組みの利点。返信待ちの間、ユーザーの別の指示に対応できる
- **`--clear` は使うな。** 他のエージェントが既にメッセージを書き込んでいる可能性がある。クリアはユーザーが明示的に指示した場合のみ
